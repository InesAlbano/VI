<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Social Inequalities</title>

    <link rel="stylesheet" href="css/style.css">
    
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body onload = "initMenu()">
    <section class="container">
        <div class="one">
          <form id="myForm" action="" method="POST">
              <!--<span id="logo">Social Inequalities</span>-->
              <img src="img/logo.png" style="width: 60%; text-align: center; margin-left: 35px">

              <li>
                  <div class="multiselect">
                      <div class="selectBox" onclick="showCheckboxes()">
                          <select>
                              
                              <option style="font-family: sans-serif, Arial;">Select the countries...</option>
                          </select>
                          <div class="overSelect"></div>
                      </div>
                      <div id="checkboxes">
                          <label for="BE"><input type="checkbox" name="country" value="BE"  id="BE"/><img class="flags" src="img/be.png"> BE</label>
                          <label for="BG"><input type="checkbox" name="country" value="BG"  id="BG"/><img class="flags" src="img/bg.svg"> BG</label>
                          <label for="CZ"><input type="checkbox" name="country" value="CZ"  id="CZ"/><img class="flags" src="img/cz.png"> CZ</label>
                          <label for="DK"><input type="checkbox" name="country" value="DK"  id="DK"/><img class="flags" src="img/dk.png"> DK</label>
                          <label for="DE"><input type="checkbox" name="country" value="DE"  id="DE"/><img class="flags" src="img/de.png"> DE</label>
                          <label for="EE"><input type="checkbox" name="country" value="EE"  id="EE"/><img class="flags" src="img/ee.png"> EE</label>
                          <label for="IE"><input type="checkbox" name="country" value="IE"  id="IE"/><img class="flags" src="img/ie.png"> IE</label>
                          <label for="EL"><input type="checkbox" name="country" value="EL"  id="EL"/><img class="flags" src="img/el.png"> EL</label>
                          <label for="ES"><input type="checkbox" name="country" value="ES"  id="ES"/><img class="flags" src="img/es.png"> ES</label>
                          <label for="FR"><input type="checkbox" name="country" value="FR"  id="FR"/><img class="flags" src="img/fr.svg"> FR</label>
                          <label for="HR"><input type="checkbox" name="country" value="HR"  id="HR"/><img class="flags" src="img/hr.png"> HR</label>
                          <label for="IT"><input type="checkbox" name="country" value="IT"  id="IT"/><img class="flags" src="img/it.svg"> IT</label>
                          <label for="CY"><input type="checkbox" name="country" value="CY"  id="CY"/><img class="flags" src="img/cy.svg"> CY</label>
                          <label for="LV"><input type="checkbox" name="country" value="LV"  id="LV"/><img class="flags" src="img/lv.svg"> LV</label>
                          <label for="LT"><input type="checkbox" name="country" value="LT"  id="LT"/><img class="flags" src="img/lt.png"> LT</label>
                          <label for="LU"><input type="checkbox" name="country" value="LU"  id="LU"/><img class="flags" src="img/lu.png"> LU</label>
                          <label for="HU"><input type="checkbox" name="country" value="HU"  id="HU"/><img class="flags" src="img/hu.png"> HU</label>
                          <label for="MT"><input type="checkbox" name="country" value="MT"  id="MT"/><img class="flags" src="img/mt.svg"> MT</label>
                          <label for="NL"><input type="checkbox" name="country" value="NL"  id="NL"/><img class="flags" src="img/nl.svg"> NL</label>
                          <label for="AT"><input type="checkbox" name="country" value="AT"  id="AT"/><img class="flags" src="img/at.svg"> AT</label>
                          <label for="PL"><input type="checkbox" name="country" value="PL"  id="PL"/><img class="flags" src="img/pl.png"> PL</label>
                          <label for="PT"><input type="checkbox" name="country" value="PT"  id="PT"/><img class="flags" src="img/pt.png"> PT</label>
                          <label for="RO"><input type="checkbox" name="country" value="RO"  id="RO"/><img class="flags" src="img/ro.png"> RO</label>
                          <label for="SI"><input type="checkbox" name="country" value="SI"  id="SI"/><img class="flags" src="img/si.png"> SI</label>
                          <label for="SK"><input type="checkbox" name="country" value="SK"  id="SK"/><img class="flags" src="img/sk.png"> SK</label>
                          <label for="FI"><input type="checkbox" name="country" value="FI"  id="FI"/><img class="flags" src="img/fi.png"> FI</label>
                          <label for="SE"><input type="checkbox" name="country" value="SE"  id="SE"/><img class="flags" src="img/se.png"> SE</label>
                      </div>
                  </div>
              </li>
              <li>
                <div class="switch-toggle switch-3 switch-candy" style="margin-left: 5px;">
                    <input type="radio" id="0-2" name="education" value="0-2" class="switch-toggle-item"><label for="0-2" onclick="">ED0_2</label>
                    <input type="radio" id="3-4" name="education" value="3-4" class="switch-toggle-item"><label for="3-4" onclick="">ED3_4</label>
                    <input type="radio" id="5-8" name="education" value="5-8" class="switch-toggle-item"><label for="5-8" onclick="">ED5_8</label>
                </div><br>
              </li>
              <br>
              <li>
                <div id="checkboxes1" style="margin-left: 55px">
                    <label class="container-checkbox" for="2010"><input type="checkbox" id="2010" name="year" value="2010"/><span class="checkmark"></span>2010</label>
                    <label class="container-checkbox" for="2011"><input type="checkbox" id="2011" name="year" value="2011"/><span class="checkmark"></span>2011</label>
                    <label class="container-checkbox" for="2012"><input type="checkbox" id="2012" name="year" value="2012"/><span class="checkmark"></span>2012</label>
                    <label class="container-checkbox" for="2013"><input type="checkbox" id="2013" name="year" value="2013"/><span class="checkmark"></span>2013</label>
                    <label class="container-checkbox" for="2014"><input type="checkbox" id="2014" name="year" value="2014"/><span class="checkmark"></span>2014</label>
                    <label class="container-checkbox" for="2015"><input type="checkbox" id="2015" name="year" value="2015"/><span class="checkmark"></span>2015</label>
                    <label class="container-checkbox" for="2016"><input type="checkbox" id="2016" name="year" value="2016"/><span class="checkmark"></span>2016</label>
                    <label class="container-checkbox" for="2017"><input type="checkbox" id="2017" name="year" value="2017"/><span class="checkmark"></span>2017</label>
                    <label class="container-checkbox" for="2018"><input type="checkbox" id="2018" name="year" value="2018"/><span class="checkmark"></span>2018</label>
                    <label class="container-checkbox" for="2019"><input type="checkbox" id="2019" name="year" value="2019"/><span class="checkmark"></span>2019</label>
                </div> <br>
              </li>
              <li>
                  <!--<input type="button" class="button-menu" value="GDP">-->
                  <div class="radio-toolbar" style="margin-left: 14px">
                      <input type="radio" id="GDP" name="variables" value="GDP"><label for="GDP">GDP</label><br>
                      <input type="radio" id="Employment" name="variables" value="Employment"><label for="Employment">Employment</label><br>
                      <input type="radio" id="Income" name="variables" value="Income"><label for="Income">Income</label><br>
                      <input type="radio" id="Education" name="variables" value="Education"><label for="Education">Education</label><br>
                      <input type="radio" id="Women-high-pos" name="variables" value="Women-high-pos"><label for="Women-high-pos">Women in High Positions</label><br>
                      <input type="radio" id="Poverty" name="variables" value="Poverty"><label for="Poverty">Poverty Level</label><br>
                      <input type="radio" id="GWG" name="variables" value="GWG"><label for="GWG">Gender Wage Gap</label>
                  </div>
              </li>
          </form>
        </div>

        <div class="two">
            <div class="container">
                <div id="cleveland-holder" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="right-div">
                    Clevaland Dot Plot
                </div>

                <div id="map-holder" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="left-div">
                    <script src="js/map.js"></script>
                    <svg id="legend" width="300" height="450"></svg>
                    <br>
                </div>
            </div>
            <br>
            <div class="container">
                <div id="line_chart" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="left-div">
                    <!-- radio button options diana: employment, poverty, GDP -->
                    <script src="js/line_chart.js"></script> 
                </div>

                <div id="slope_chart" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="right-div">
                  <!--<script src="js/slope_chart.js"></script>-->
                </div>
            </div>

        </div>
    </section>

</body>
</html>

<style>
.container {
  width: 100%;
  height: 100%;
  display : flex;
}

.one {
  width: 200px;
  height: 100%;
  float: left;
}

.two {
  margin-left: 20px;
  width: 100%;
  height: 100%;
  padding-right: 10px;
  padding-top: 10px;
  display:table;
  table-layout:fixed;
}

.left-div {
  float: left;
  text-align: center;
  flex: 1;
  overflow-x: hidden;
  margin-left: 15px;
}

.right-div {
  text-align: center;
  flex: 1;
  margin-left: 15px;
}

#myForm {
  height: 100%;
  width: 200px;
  position: fixed;
  z-index: 1;
  top: 0;
  left: 0;
  background-color: #111;
  overflow-x: hidden;
  padding-top: 20px;
}

/* Education */
.switch-toggle-item {
  padding: 8px 20px;
  font-family: sans-serif, Arial;
  border-radius: 4px;
  width: 10px;
  text-align: center;
}

.switch-toggle {
  float: left;
  background-color: #878787;
  border: 4px solid #E3E0E0;
  border-radius: 4px;
}
.switch-toggle input {
  position: absolute;
  opacity: 0;
}
.switch-toggle input + label {
  padding: 3px;
  float:left;
  color: black;
  cursor: pointer;
  border: 1px solid #878787;
}

.switch-toggle input:checked + label {
  background-color: #AFAFAF;
  cursor: pointer;
  border: 1px solid #1A1C1F;
  border-radius: 4px;
}

/* Years */
.container-checkbox {
  display: block;
  position: relative;
  padding-left: 20px;
  margin-top: 15px;
  cursor: pointer;
}

.container-checkbox input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.checkmark {
  position: absolute;
  top: 0;
  left: 0;
  height: 12px;
  width: 12px;
  border-radius: 6px;
  background-color: #AFAFAF;
  border: 0.5px solid #AFAFAF;
}

.container-checkbox:hover input ~ .checkmark {
  background-color: #e2c9a2;
  border: 0.5px solid #e2c9a2;
}

.container-checkbox input:checked ~ .checkmark {
  background-color: #E0C090;
  border: 0.5px solid #e4a950;
}

.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}


/* Countries */


</style>


<script>
    var expanded = false;

    function showCheckboxes() {
        var checkboxes = document.getElementById("checkboxes"); //countries
        if (!expanded) {
            checkboxes.style.display = "block";
            expanded = true;
        } else {
            checkboxes.style.display = "none";
            expanded = false;
        }
    }
</script>

<script>

function initMenu() {
  var checkbox;

  checkbox = document.querySelector("input[type=checkbox][id=BE]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=BG]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=CZ]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=PT]");
  checkbox.checked = true;
  localStorage.setItem("countries", ["BE", "BG", "CZ", "PT"])

  document.getElementById('0-2').checked = true;
  localStorage.setItem("education", "0-2");

  checkbox = document.getElementById("2010");
  checkbox.checked = true;
  checkbox = document.getElementById("2011");
  checkbox.checked = true;
  checkbox = document.getElementById("2012");
  checkbox.checked = true;
  localStorage.setItem("years", ["2010", "2011", "2012"])

  document.getElementById('GDP').checked = true;
  localStorage.setItem("variable", "GDP");


  /* on change Education */
  var checkboxes = document.querySelectorAll("input[type=radio][name=variables]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });

  /* on change Education */
  var checkboxes = document.querySelectorAll("input[type=radio][name=education]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });

  /* on change Countries */
  var checkboxes = document.querySelectorAll("input[type=checkbox][name=country]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });


  /* on change YEARS */
  var checkboxes = document.querySelectorAll("input[type=checkbox][name=year]");
  let counter = 0;
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      counter = counter + 1;
      checkMiddleBoxes(checkbox, counter);
      updateCharts();
    })
  });
}

function checkMiddleBoxes(c, counter){
  let years = ["2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019"];
  let years_checked = [false,false,false,false,false,false,false,false,false,false]

  if (counter % 2 == 0) { // recomecar
    var checkedboxes = [document.getElementById(c.value)];
  } else { // preencher
    var checkedboxes = document.querySelectorAll("input[type=checkbox][name=year]:checked");
  }


  for (let i = 0; i< years.length; ++i){
    if (years[i] === checkedboxes[0].value){
      years_checked[i] = true;
    }

    if (years[i] === checkedboxes[checkedboxes.length-1].value){
      years_checked[i] = true;
    }
  }


  if (checkedboxes.length > 1){
    fill = false;
    for (let i = 0; i< years_checked.length; ++i){
      if (years_checked[i] == true && fill == false){
        fill = true;
      } else if (years_checked[i] == false && fill == true) { // fill middle
        document.getElementById(years[i]).checked = true;
      } else if (years_checked[i] == true && fill == true) {
        fill = false;
      } else {
        document.getElementById(years[i]).checked = false;
      }
    }
  } else {
    var checkedboxes = document.querySelectorAll("input[type=checkbox][name=year]");
    checkedboxes.forEach(function(checkbox) {
      checkbox.checked = false;
    });
    document.getElementById(c.value).checked = true;
  }
  

}



function myFunction(event) {
  localStorage.clear();
  var countries = [];
  var education = '';
  var years = [];
  var variable = '';


  /*get countries */
  checkboxes = document.getElementsByName("country");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true)
          countries.push(checkboxes[i].value);
  }

  /*get education*/
  checkboxes = document.getElementsByName("education");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true){
          education = checkboxes[i].value;
          break;
      }
  }

  /*get years */
  checkboxes = document.getElementsByName("year");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true)
          years.push(parseInt(checkboxes[i].value));
  }

  /*get bottom variables*/
  checkboxes = document.getElementsByName("variables");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true){
          variable = checkboxes[i].value;
      }
  }

  if (countries.length != 0 && education != '' && years.length != 0 && variable != '') {
    localStorage.setItem("education", education);
    localStorage.setItem("variable", variable);

    if(countries.length > 1) { // Case: more than 1 country is selected
        localStorage.setItem("countries", JSON.stringify(countries));
    } else { // Case: only 1 country is selected
        localStorage.setItem("countries", countries);
    }

    if(years.length > 1) { // Case: more than 1 year is selected
        localStorage.setItem("years", JSON.stringify(years));
    } else { // Case: Only 1 year is selected
        localStorage.setItem("years", years);
    }
  }
}

function updateCharts(){
  myFunction(null);
  const event = new Event('updateCharts');
  document.dispatchEvent(event);
}



</script>
