<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Social Inequalities</title>

    <link rel="stylesheet" href="css/style.css">
    
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v6.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body onload = "initMenu()">
    <section class="container">
        <div class="one">
          <form id="myForm" action="" method="POST">
              <!--<span id="logo">Social Inequalities</span>-->
              <img src="img/logo.png" style="width: 60%; text-align: center; margin-left: 35px">

              <li>
                  <div class="multiselect" onmouseout="hideCheckboxes();" onmouseover="showCheckboxes();">
                      <div class="selectBox" >
                          <input type="text" id="myInput" onkeyup="showCheckboxes();searchBar()" autocomplete="off" placeholder="Search for country.." title="Type in a country" style="width:160px;font-family: sans-serif, Arial;">                          
                      </div>
                      <div id="checkboxes">
                          <label for="BE"><input type="checkbox" name="country" value="BE"  id="BE"/><img class="flags" src="img/be.png"> BE - Belgium</label>
                          <label for="BG"><input type="checkbox" name="country" value="BG"  id="BG"/><img class="flags" src="img/bg.svg"> BG - Bulgaria</label>
                          <label for="CZ"><input type="checkbox" name="country" value="CZ"  id="CZ"/><img class="flags" src="img/cz.png"> CZ - Czechia</label>
                          <label for="DK"><input type="checkbox" name="country" value="DK"  id="DK"/><img class="flags" src="img/dk.png"> DK - Denmark</label>
                          <label for="DE"><input type="checkbox" name="country" value="DE"  id="DE"/><img class="flags" src="img/de.png"> DE - Germany</label>
                          <label for="EE"><input type="checkbox" name="country" value="EE"  id="EE"/><img class="flags" src="img/ee.png"> EE - Estonia</label>
                          <label for="IE"><input type="checkbox" name="country" value="IE"  id="IE"/><img class="flags" src="img/ie.png"> IE - Ireland</label>
                          <label for="EL"><input type="checkbox" name="country" value="EL"  id="EL"/><img class="flags" src="img/el.png"> EL - Greece</label>
                          <label for="ES"><input type="checkbox" name="country" value="ES"  id="ES"/><img class="flags" src="img/es.png"> ES - Spain</label>
                          <label for="FR"><input type="checkbox" name="country" value="FR"  id="FR"/><img class="flags" src="img/fr.svg"> FR - France</label>
                          <label for="HR"><input type="checkbox" name="country" value="HR"  id="HR"/><img class="flags" src="img/hr.png"> HR - Croatia</label>
                          <label for="IT"><input type="checkbox" name="country" value="IT"  id="IT"/><img class="flags" src="img/it.svg"> IT - Italy</label>
                          <label for="CY"><input type="checkbox" name="country" value="CY"  id="CY"/><img class="flags" src="img/cy.svg"> CY - Cyprus</label>
                          <label for="LV"><input type="checkbox" name="country" value="LV"  id="LV"/><img class="flags" src="img/lv.svg"> LV - Latvia</label>
                          <label for="LT"><input type="checkbox" name="country" value="LT"  id="LT"/><img class="flags" src="img/lt.png"> LT - Lithuania</label>
                          <label for="LU"><input type="checkbox" name="country" value="LU"  id="LU"/><img class="flags" src="img/lu.png"> LU - Luxembourg</label>
                          <label for="HU"><input type="checkbox" name="country" value="HU"  id="HU"/><img class="flags" src="img/hu.png"> HU - Hungary</label>
                          <label for="MT"><input type="checkbox" name="country" value="MT"  id="MT"/><img class="flags" src="img/mt.svg"> MT - Malta</label>
                          <label for="NL"><input type="checkbox" name="country" value="NL"  id="NL"/><img class="flags" src="img/nl.svg"> NL - Netherlands</label>
                          <label for="AT"><input type="checkbox" name="country" value="AT"  id="AT"/><img class="flags" src="img/at.svg"> AT - Austria</label>
                          <label for="PL"><input type="checkbox" name="country" value="PL"  id="PL"/><img class="flags" src="img/pl.png"> PL - Poland</label>
                          <label for="PT"><input type="checkbox" name="country" value="PT"  id="PT"/><img class="flags" src="img/pt.png"> PT - Portugal</label>
                          <label for="RO"><input type="checkbox" name="country" value="RO"  id="RO"/><img class="flags" src="img/ro.png"> RO - Romania</label>
                          <label for="SI"><input type="checkbox" name="country" value="SI"  id="SI"/><img class="flags" src="img/si.png"> SI - Slovenia</label>
                          <label for="SK"><input type="checkbox" name="country" value="SK"  id="SK"/><img class="flags" src="img/sk.png"> SK - Slovakia</label>
                          <label for="FI"><input type="checkbox" name="country" value="FI"  id="FI"/><img class="flags" src="img/fi.png"> FI - Finland</label>
                          <label for="SE"><input type="checkbox" name="country" value="SE"  id="SE"/><img class="flags" src="img/se.png"> SE - Sweden</label>
                      </div>
                  </div>
              </li>
              <li>
                <div class="switch-toggle switch-3 switch-candy" style="margin-left: 5px;">
                    <input type="radio" id="0-2" name="education" value="0-2" class="switch-toggle-item"><label for="0-2" onclick="">ED0_2</label>
                    <input type="radio" id="3-4" name="education" value="3-4" class="switch-toggle-item"><label for="3-4" onclick="">ED3_4</label>
                    <input type="radio" id="5-8" name="education" value="5-8" class="switch-toggle-item"><label for="5-8" onclick="">ED5_8</label>
                </div><br>
              </li>
              <br>
              <li>
                <div id="checkboxes1" style="margin-left: 55px">
                    <label class="container-checkbox" for="2010"><input type="checkbox" id="2010" name="year" value="2010"/><span class="checkmark"></span>2010</label>
                    
                    <div class="rectangle" id="2011-rect" style="height: 15px;width: 3px; background-color: #E0C090; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div>       
                    <label class="container-checkbox" for="2011" style="margin-top: -1px;"><input type="checkbox" id="2011" name="year" value="2011"/><span class="checkmark"></span>2011</label>
                    
                    <div class="rectangle" id="2012-rect" style="height: 15px;width: 3px; background-color: #E0C090; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div>       
                    <label class="container-checkbox" for="2012" style="margin-top: -1px;"><input type="checkbox" id="2012" name="year" value="2012"/><span class="checkmark"></span>2012</label>
                    
                    <div class="rectangle" id="2013-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div>       
                    <label class="container-checkbox" for="2013" style="margin-top: -1px;"><input type="checkbox" id="2013" name="year" value="2013"/><span class="checkmark"></span>2013</label>
                    
                    <div class="rectangle" id="2014-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div>       
                    <label class="container-checkbox" for="2014" style="margin-top: -1px;"><input type="checkbox" id="2014" name="year" value="2014"/><span class="checkmark"></span>2014</label>
                    
                    <div class="rectangle" id="2015-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div> 
                    <label class="container-checkbox" for="2015" style="margin-top: -1px;"><input type="checkbox" id="2015" name="year" value="2015"/><span class="checkmark"></span>2015</label>
                    
                    <div class="rectangle" id="2016-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div>                
                    <label class="container-checkbox" for="2016" style="margin-top: -1px;"><input type="checkbox" id="2016" name="year" value="2016"/><span class="checkmark"></span>2016</label>
                    
                    <div class="rectangle" id="2017-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div> 
                    <label class="container-checkbox" for="2017" style="margin-top: -1px;"><input type="checkbox" id="2017" name="year" value="2017"/><span class="checkmark"></span>2017</label>
                    
                    <div class="rectangle" id="2018-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div> 
                    <label class="container-checkbox" for="2018" style="margin-top: -1px;"><input type="checkbox" id="2018" name="year" value="2018"/><span class="checkmark"></span>2018</label>
                    
                    <div class="rectangle" id="2019-rect" style="height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"></div> 
                    <label class="container-checkbox" for="2019" style="margin-top: -1px;"><input type="checkbox" id="2019" name="year" value="2019"/><span class="checkmark"></span>2019</label>

                </div> <br>
              </li>
              <li>
                  <!--<input type="button" class="button-menu" value="GDP">-->
                  <div class="radio-toolbar" style="margin-left: 14px">
                      <input type="radio" id="GDP" name="variables" value="GDP"><label for="GDP">GDP</label><br>
                      <input type="radio" id="Employment" name="variables" value="Employment"><label for="Employment">Employment</label><br>
                      <input type="radio" id="Income" name="variables" value="Income"><label for="Income">Income</label><br>
                      <input type="radio" id="Education" name="variables" value="Education"><label for="Education">Education</label><br>
                      <input type="radio" id="Women-high-pos" name="variables" value="Women-high-pos"><label for="Women-high-pos">Women in High Positions</label><br>
                      <input type="radio" id="Poverty" name="variables" value="Poverty"><label for="Poverty">Poverty Level</label><br>
                      <input type="radio" id="GWG" name="variables" value="GWG"><label for="GWG">Gender Wage Gap</label>
                  </div>
              </li>
          </form>
        </div>

        <div class="two">
            <div class="container">
                <div id="cleveland_chart" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="right-div">
                  <script src="js/cleveland.js"></script>
                  <svg id="legenda" width="600" height="200"></svg>
                </div>

                <div id="map-holder" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="left-div">
                    <script src="js/map.js"></script>
                    <svg id="legend" width="300" height="450"></svg>
                    <br>
                </div>
            </div>
            <br>
            <div class="container">
                <div id="line_chart" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="left-div">
                    <!-- radio button options diana: employment, poverty, GDP -->
                    <script src="js/line_chart.js"></script> 
                </div>

                <div id="slope_chart" style="background-color: rgba(227, 224, 224, 0.1); border-radius: 15px;" class="right-div">
                  <script src="js/slope_chart.js"></script>
                </div>
            </div>

        </div>
    </section>

</body>
</html>

<script>
    var expanded = false;

    function showCheckboxes() {
        var checkboxes = document.getElementById("checkboxes"); //countries
        checkboxes.style.display = "block";
        expanded = true;
    }

    function hideCheckboxes(){
      var checkboxes = document.getElementById("checkboxes"); //countries
      checkboxes.style.display = "none";
      expanded = false;
    }

    
  function searchBar() {
    var input, filter, ul, li, a, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    ul = document.getElementById("checkboxes");
    li = ul.getElementsByTagName("label");


    for (i = 0; i < li.length; i++) {
        a = li[i];
        txtValue = a.textContent || a.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
            li[i].style.display = "";
        } else {
            li[i].style.display = "none";
        }
    }
  }
</script>


<script>

function initMenu() {
  var checkbox;

  checkbox = document.querySelector("input[type=checkbox][id=BE]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=BG]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=CZ]");
  checkbox.checked = true;
  checkbox = document.querySelector("input[type=checkbox][id=PT]");
  checkbox.checked = true;
  localStorage.setItem("countries", ["BE", "BG", "CZ", "PT"])

  document.getElementById('0-2').checked = true;
  localStorage.setItem("education", "0-2");

  checkbox = document.getElementById("2010");
  checkbox.checked = true;
  checkbox = document.getElementById("2011");
  checkbox.checked = true;
  checkbox = document.getElementById("2012");
  checkbox.checked = true;
  localStorage.setItem("years", ["2010", "2011", "2012"])

  document.getElementById('GDP').checked = true;
  localStorage.setItem("variable", "GDP");


  /* on change Education */
  var checkboxes = document.querySelectorAll("input[type=radio][name=variables]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });

  /* on change Education */
  var checkboxes = document.querySelectorAll("input[type=radio][name=education]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });

  /* on change Countries */
  var checkboxes = document.querySelectorAll("input[type=checkbox][name=country]");
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      updateCharts();
    })
  });


  /* on change YEARS */
  var checkboxes = document.querySelectorAll("input[type=checkbox][name=year]");
  let counter = 0;
  checkboxes.forEach(function(checkbox) {
    checkbox.addEventListener('change', function() {
      counter = counter + 1;
      checkMiddleBoxes(checkbox, counter);
      updateCharts();
    })
  });
}

function checkMiddleBoxes(c, counter){
  let years = ["2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019"];
  let years_rect = ["2011-rect", "2012-rect", "2013-rect", "2014-rect", "2015-rect", "2016-rect", "2017-rect", "2018-rect", "2019-rect"];
  let years_checked = [false,false,false,false,false,false,false,false,false,false]

  if (counter % 2 != 0) { // recomecar
    var checkedboxes = [document.getElementById(c.value)];
  } else { // preencher
    var checkedboxes = document.querySelectorAll("input[type=checkbox][name=year]:checked");
  }


  for (let i = 0; i< years.length; ++i){
    if (years[i] === checkedboxes[0].value){
      years_checked[i] = true;
    }

    if (years[i] === checkedboxes[checkedboxes.length-1].value){
      years_checked[i] = true;
    }
  }

  if (checkedboxes.length > 1){
    fill = false;
    for (let i = 0; i< years_checked.length - 1; ++i){
      if (years_checked[i] == true && fill == false){
        fill = true;
        document.getElementById(years_rect[i]).style = "height: 15px;width: 3px; background-color: #E0C090; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"
      } else if (years_checked[i] == false && fill == true) { // fill middle
        document.getElementById(years[i]).checked = true;
        document.getElementById(years_rect[i]).style = "height: 15px;width: 3px; background-color: #E0C090; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"
      } else if (years_checked[i] == true && fill == true) {
        fill = false;
        document.getElementById(years_rect[i]).style = "height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"
      } else {
        document.getElementById(years[i]).checked = false;
        document.getElementById(years_rect[i]).style = "height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"
      }
    }
  } else {    
    var checkedboxes = document.querySelectorAll("input[type=checkbox][name=year]");
    checkedboxes.forEach(function(checkbox) {
      checkbox.checked = false;
    });
    for (let i = 0; i < years_checked.length - 1; ++i){
      document.getElementById(years_rect[i]).style = "height: 15px;width: 3px; background-color: #AFAFAF; position: relative;z-index: -1; margin-top: -1px; margin-left: 5.5px;"
    }
    document.getElementById(c.value).checked = true;
  }
  console.log(years_checked)
}



function myFunction(event) {
  localStorage.clear();
  var countries = [];
  var education = '';
  var years = [];
  var variable = '';


  /*get countries */
  checkboxes = document.getElementsByName("country");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true)
          countries.push(checkboxes[i].value);
  }

  /*get education*/
  checkboxes = document.getElementsByName("education");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true){
          education = checkboxes[i].value;
          break;
      }
  }

  /*get years */
  checkboxes = document.getElementsByName("year");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true)
          years.push(parseInt(checkboxes[i].value));
  }

  /*get bottom variables*/
  checkboxes = document.getElementsByName("variables");
  for (let i=0; i < checkboxes.length; ++i){
      if(checkboxes[i].checked==true){
          variable = checkboxes[i].value;
      }
  }

  if (countries.length != 0 && education != '' && years.length != 0 && variable != '') {
    localStorage.setItem("education", education);
    localStorage.setItem("variable", variable);

    if(countries.length > 1) { // Case: more than 1 country is selected
        localStorage.setItem("countries", JSON.stringify(countries));
    } else { // Case: only 1 country is selected
        localStorage.setItem("countries", countries);
    }

    if(years.length > 1) { // Case: more than 1 year is selected
        localStorage.setItem("years", JSON.stringify(years));
    } else { // Case: Only 1 year is selected
        localStorage.setItem("years", years);
    }
  }
}

function updateCharts(){
  myFunction(null);
  const event = new Event('updateCharts');
  document.dispatchEvent(event);
}



</script>
